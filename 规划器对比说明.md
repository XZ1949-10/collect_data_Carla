# ä¸‰ç§è§„åˆ’å™¨çš„å‘½ä»¤è·å–æ–¹æ³•å¯¹æ¯”

## ğŸ“‹ ä¸‰ä¸ªè§„åˆ’å™¨å¯¹æ¯”

### 1. **local_planner_info.py** (ä½ çš„å¤–éƒ¨æ§åˆ¶ç‰ˆæœ¬)
- æ–‡ä»¶ï¼š`agents/navigation/local_planner_info.py`
- æ–¹æ³•ï¼š`run_step()`
- è¿”å›ï¼š**ç›®æ ‡è·¯ç‚¹ä¿¡æ¯å­—å…¸**ï¼ˆä¸åŒ…å«æ§åˆ¶æŒ‡ä»¤ï¼‰

### 2. **åŸå§‹ local_planner.py** (CARLAè‡ªå¸¦ç‰ˆæœ¬)
- æ–‡ä»¶ï¼š`agents/navigation/local_planner.py`
- æ–¹æ³•ï¼š`run_step()`
- è¿”å›ï¼š**VehicleControl å¯¹è±¡**ï¼ˆåŒ…å«æ²¹é—¨ã€åˆ¹è½¦ã€è½¬å‘ï¼‰

### 3. **planner.py** (é«˜å±‚è§„åˆ’å™¨)
- æ–‡ä»¶ï¼š`planner/planner.py`
- æ–¹æ³•ï¼š`get_next_command()`
- è¿”å›ï¼š**é«˜å±‚å‘½ä»¤æ•°å€¼**ï¼ˆ0.0-5.0 çš„æµ®ç‚¹æ•°ï¼‰

---

## ğŸ” è¯¦ç»†å¯¹æ¯”

### å¯¹æ¯”è¡¨æ ¼

| ç‰¹æ€§ | local_planner_info.py | åŸå§‹ local_planner.py | planner.py |
|------|----------------------|----------------------|------------|
| **å±‚çº§** | ä½å±‚ï¼ˆæˆ˜æœ¯ï¼‰ | ä½å±‚ï¼ˆæˆ˜æœ¯ï¼‰ | é«˜å±‚ï¼ˆæˆ˜ç•¥ï¼‰ |
| **è¿”å›ç±»å‹** | `dict` å­—å…¸ | `VehicleControl` å¯¹è±¡ | `float` æ•°å€¼ |
| **åŒ…å«æ§åˆ¶å€¼** | âŒ ä¸åŒ…å« | âœ… åŒ…å« | âŒ ä¸åŒ…å« |
| **éœ€è¦å¤–éƒ¨æ§åˆ¶å™¨** | âœ… éœ€è¦ | âŒ ä¸éœ€è¦ | âœ… éœ€è¦ |
| **è·¯ç‚¹ç®¡ç†** | âœ… æœ‰ | âœ… æœ‰ | âŒ æ—  |
| **PIDæ§åˆ¶å™¨** | âŒ æ—  | âœ… æœ‰ | âŒ æ—  |
| **åœ°å›¾ç±»å‹** | CARLAåœ°å›¾ | CARLAåœ°å›¾ | è‡ªå®šä¹‰åœ°å›¾ |
| **é€‚ç”¨åœºæ™¯** | è‡ªå®šä¹‰æ§åˆ¶ | æ ‡å‡†å¯¼èˆª | é«˜å±‚å†³ç­– |

---

## 1ï¸âƒ£ local_planner_info.py (ä½ çš„ç‰ˆæœ¬)

### run_step() è¿”å›å€¼

```python
target_info = local_planner.run_step()

# è¿”å›å­—å…¸ï¼š
{
    'target_waypoint': carla.Waypoint,  # ç›®æ ‡è·¯ç‚¹å¯¹è±¡
    'target_road_option': RoadOption,   # é“è·¯åŠ¨ä½œæšä¸¾ (LEFT/RIGHT/LANEFOLLOWç­‰)
    'target_speed': 30.0,               # å»ºè®®é€Ÿåº¦ (km/h)
    'queue_length': 92,                 # å‰©ä½™è·¯ç‚¹æ•°
    'is_empty': False                   # æ˜¯å¦ä¸ºç©º
}
```

### ç‰¹ç‚¹

```python
# âŒ ä¸åŒ…å«æ§åˆ¶æŒ‡ä»¤ï¼ˆæ²¹é—¨ã€åˆ¹è½¦ã€è½¬å‘ï¼‰
# âœ… åªæä¾›ç›®æ ‡è·¯ç‚¹ä¿¡æ¯
# âœ… éœ€è¦å¤–éƒ¨æ§åˆ¶å™¨è®¡ç®—æ§åˆ¶å€¼

# ä½¿ç”¨æµç¨‹ï¼š
target_info = local_planner.run_step()
â†“
throttle, brake, steer = external_controller.compute(target_info)  # å¤–éƒ¨è®¡ç®—
â†“
local_planner.apply_control(throttle, brake, steer)
```

### ä»£ç ç¤ºä¾‹

```python
from agents.navigation.local_planner_info import LocalPlanner

# åˆå§‹åŒ–
local_planner = LocalPlanner(vehicle)
local_planner.set_global_plan(route)

# ä½¿ç”¨
while not local_planner.done():
    # è·å–ç›®æ ‡ä¿¡æ¯ï¼ˆä¸åŒ…å«æ§åˆ¶æŒ‡ä»¤ï¼‰
    target_info = local_planner.run_step()
    
    # éœ€è¦å¤–éƒ¨æ§åˆ¶å™¨
    throttle, brake, steer = my_controller.compute(
        target_info['target_waypoint'],
        target_info['target_speed'],
        vehicle
    )
    
    # åº”ç”¨æ§åˆ¶
    local_planner.apply_control(throttle, brake, steer)
    world.tick()
```

---

## 2ï¸âƒ£ åŸå§‹ local_planner.py (CARLAè‡ªå¸¦)

### run_step() è¿”å›å€¼

```python
control = local_planner.run_step()

# è¿”å› VehicleControl å¯¹è±¡ï¼š
VehicleControl(
    throttle=0.45,      # æ²¹é—¨å€¼ [0.0, 1.0]
    brake=0.0,          # åˆ¹è½¦å€¼ [0.0, 1.0]
    steer=-0.12,        # è½¬å‘å€¼ [-1.0, 1.0]
    hand_brake=False,
    manual_gear_shift=False
)
```

### ç‰¹ç‚¹

```python
# âœ… ç›´æ¥åŒ…å«æ§åˆ¶æŒ‡ä»¤ï¼ˆæ²¹é—¨ã€åˆ¹è½¦ã€è½¬å‘ï¼‰
# âœ… å†…ç½®PIDæ§åˆ¶å™¨è‡ªåŠ¨è®¡ç®—
# âŒ æ— æ³•è‡ªå®šä¹‰æ§åˆ¶ç®—æ³•

# ä½¿ç”¨æµç¨‹ï¼š
control = local_planner.run_step()  # ä¸€æ­¥åˆ°ä½
â†“
vehicle.apply_control(control)  # ç›´æ¥åº”ç”¨
```

### ä»£ç ç¤ºä¾‹

```python
from agents.navigation.local_planner import LocalPlanner

# åˆå§‹åŒ–ï¼ˆéœ€è¦PIDå‚æ•°ï¼‰
opt_dict = {
    'target_speed': 30.0,
    'lateral_control_dict': {'K_P': 1.95, 'K_I': 0.05, 'K_D': 0.2, 'dt': 0.05},
    'longitudinal_control_dict': {'K_P': 1.0, 'K_I': 0.05, 'K_D': 0, 'dt': 0.05},
}
local_planner = LocalPlanner(vehicle, opt_dict=opt_dict)
local_planner.set_global_plan(route)

# ä½¿ç”¨ï¼ˆç®€å•ï¼‰
while not local_planner.done():
    # ç›´æ¥è·å–æ§åˆ¶æŒ‡ä»¤ï¼ˆå†…ç½®PIDè®¡ç®—ï¼‰
    control = local_planner.run_step()
    
    # ç›´æ¥åº”ç”¨ï¼ˆä¸éœ€è¦å¤–éƒ¨æ§åˆ¶å™¨ï¼‰
    vehicle.apply_control(control)
    world.tick()
```

---

## 3ï¸âƒ£ planner.py (é«˜å±‚è§„åˆ’å™¨)

### get_next_command() è¿”å›å€¼

```python
command = planner.get_next_command(source, source_ori, target, target_ori)

# è¿”å›æµ®ç‚¹æ•°å‘½ä»¤ï¼š
0.0  # REACH_GOAL - åˆ°è¾¾ç›®æ ‡
2.0  # LANE_FOLLOW - è½¦é“è·Ÿéš
3.0  # TURN_LEFT - å·¦è½¬
4.0  # TURN_RIGHT - å³è½¬
5.0  # GO_STRAIGHT - ç›´è¡Œ
```

### ç‰¹ç‚¹

```python
# âŒ ä¸åŒ…å«æ§åˆ¶æŒ‡ä»¤
# âŒ ä¸ç®¡ç†è·¯ç‚¹é˜Ÿåˆ—
# âœ… åªæä¾›é«˜å±‚å†³ç­–ï¼ˆå·¦è½¬/å³è½¬/ç›´è¡Œï¼‰
# âœ… åŸºäºå›¾åƒåœ°å›¾ï¼ˆä¸æ˜¯CARLAçš„3Dåœ°å›¾ï¼‰

# ä½¿ç”¨æµç¨‹ï¼š
command = planner.get_next_command(...)  # é«˜å±‚å‘½ä»¤
â†“
æ ¹æ®å‘½ä»¤æ‰§è¡Œç›¸åº”ç­–ç•¥  # ä¸­å±‚å†³ç­–
â†“
è®¡ç®—å…·ä½“æ§åˆ¶å€¼  # ä½å±‚æ§åˆ¶
```

### ä»£ç ç¤ºä¾‹

```python
from planner.planner import Planner

# åˆå§‹åŒ–ï¼ˆä½¿ç”¨åŸå¸‚åç§°ï¼‰
planner = Planner('Town01')

# ä½¿ç”¨
source = [100.0, 200.0]      # å½“å‰ä½ç½® [x, y]
source_ori = [1.0, 0.0]      # å½“å‰æœå‘ [x, y]
target = [150.0, 250.0]      # ç›®æ ‡ä½ç½® [x, y]
target_ori = [0.0, 1.0]      # ç›®æ ‡æœå‘ [x, y]

# è·å–é«˜å±‚å‘½ä»¤
command = planner.get_next_command(source, source_ori, target, target_ori)

if command == 3.0:  # TURN_LEFT
    print("éœ€è¦å·¦è½¬")
    # æ‰§è¡Œå·¦è½¬ç­–ç•¥...
elif command == 4.0:  # TURN_RIGHT
    print("éœ€è¦å³è½¬")
    # æ‰§è¡Œå³è½¬ç­–ç•¥...
elif command == 5.0:  # GO_STRAIGHT
    print("ç›´è¡Œ")
    # æ‰§è¡Œç›´è¡Œç­–ç•¥...
```

---

## ğŸ“Š æ ¸å¿ƒå·®å¼‚æ€»ç»“

### è¿”å›å€¼å¯¹æ¯”

```python
# 1. local_planner_info.py (ä½ çš„ç‰ˆæœ¬)
target_info = local_planner.run_step()
â†’ {
    'target_waypoint': Waypointå¯¹è±¡,
    'target_road_option': RoadOptionæšä¸¾,
    'target_speed': 30.0,
    'queue_length': 92,
    'is_empty': False
  }

# 2. åŸå§‹ local_planner.py
control = local_planner.run_step()
â†’ VehicleControl(
    throttle=0.45,
    brake=0.0,
    steer=-0.12
  )

# 3. planner.py
command = planner.get_next_command(...)
â†’ 3.0  # å•ä¸ªæ•°å€¼ (TURN_LEFT)
```

### æŠ½è±¡å±‚çº§å¯¹æ¯”

```
é«˜å±‚ (æˆ˜ç•¥)    planner.py
    â†“          get_next_command()
    â†“          è¿”å›: LEFT/RIGHT/STRAIGHT (3.0, 4.0, 5.0)
    â†“          "åº”è¯¥å¾€å“ªä¸ªæ–¹å‘èµ°"
    â†“
ä¸­å±‚ (æˆ˜æœ¯)    local_planner_info.py (ä½ çš„ç‰ˆæœ¬)
    â†“          run_step()
    â†“          è¿”å›: target_waypoint, target_road_option
    â†“          "ä¸‹ä¸€ä¸ªè·¯ç‚¹åœ¨å“ªï¼Œæ€ä¹ˆåˆ°è¾¾"
    â†“
ä½å±‚ (æ‰§è¡Œ)    å¤–éƒ¨æ§åˆ¶å™¨
    â†“          compute()
    â†“          è¿”å›: throttle, brake, steer
    â†“          "å…·ä½“çš„æ²¹é—¨ã€åˆ¹è½¦ã€è½¬å‘å€¼"
    â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â†’ è½¦è¾†æ‰§è¡Œ


å¯¹æ¯”ï¼šåŸå§‹ local_planner.py ç›´æ¥æ•´åˆäº†ä¸­å±‚+ä½å±‚
    â†“          run_step()
    â†“          è¿”å›: VehicleControl (throttle, brake, steer)
    â†“          "ç›´æ¥ç»™å‡ºæ§åˆ¶æŒ‡ä»¤"
```

---

## ğŸ’¡ ä½¿ç”¨åœºæ™¯å¯¹æ¯”

### local_planner_info.py (ä½ çš„ç‰ˆæœ¬) é€‚åˆï¼š

```python
âœ… éœ€è¦è‡ªå®šä¹‰æ§åˆ¶ç®—æ³•
âœ… æœºå™¨å­¦ä¹ /å¼ºåŒ–å­¦ä¹ 
âœ… ç ”ç©¶å’Œå®éªŒ
âœ… ä¸å…¶ä»–ç³»ç»Ÿé›†æˆ
âœ… ç²¾ç¡®æ§åˆ¶æ¯ä¸ªå‚æ•°

ç¤ºä¾‹ï¼š
# ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•æ§åˆ¶ç®—æ³•
throttle, brake, steer = my_neural_network.predict(target_info)
throttle, brake, steer = my_pid_controller.compute(target_info)
throttle, brake, steer = my_fuzzy_controller.compute(target_info)
```

### åŸå§‹ local_planner.py é€‚åˆï¼š

```python
âœ… æ ‡å‡†çš„è‡ªåŠ¨é©¾é©¶ä»»åŠ¡
âœ… å¿«é€ŸåŸå‹å¼€å‘
âœ… ä¸éœ€è¦ä¿®æ”¹æ§åˆ¶é€»è¾‘
âœ… ä½¿ç”¨CARLAè‡ªå¸¦çš„PIDæ§åˆ¶å™¨

ç¤ºä¾‹ï¼š
# ä¸€è¡Œä»£ç æå®š
control = local_planner.run_step()
vehicle.apply_control(control)
```

### planner.py é€‚åˆï¼š

```python
âœ… é«˜å±‚è·¯å¾„è§„åˆ’
âœ… ç®€å•çš„å¯¼èˆªå†³ç­–
âœ… åŸºäº2Dåœ°å›¾çš„è§„åˆ’
âœ… ä¸éœ€è¦ç²¾ç¡®æ§åˆ¶

ç¤ºä¾‹ï¼š
# åªå…³å¿ƒæ–¹å‘ï¼Œä¸å…³å¿ƒå…·ä½“æ§åˆ¶
command = planner.get_next_command(...)
if command == TURN_LEFT:
    æ‰§è¡Œå·¦è½¬é€»è¾‘()
```

---

## ğŸ¯ ä»£ç å¯¹æ¯”ç¤ºä¾‹

### ç¤ºä¾‹ï¼šå®ŒæˆåŒæ ·çš„å¯¼èˆªä»»åŠ¡

#### æ–¹å¼1: ä½¿ç”¨ local_planner_info.py (ä½ çš„ç‰ˆæœ¬)

```python
from agents.navigation.local_planner_info import LocalPlanner

# éœ€è¦3æ­¥
# æ­¥éª¤1: åˆå§‹åŒ–è§„åˆ’å™¨
local_planner = LocalPlanner(vehicle)
local_planner.set_global_plan(route)

# æ­¥éª¤2: åˆ›å»ºå¤–éƒ¨æ§åˆ¶å™¨
controller = MyController(vehicle)

# æ­¥éª¤3: å¯¼èˆªå¾ªç¯
while not local_planner.done():
    # è·å–ç›®æ ‡ä¿¡æ¯
    target_info = local_planner.run_step()  # è¿”å›å­—å…¸
    
    # å¤–éƒ¨æ§åˆ¶å™¨è®¡ç®—
    throttle, brake, steer = controller.compute(
        target_info['target_waypoint'],
        target_info['target_speed']
    )
    
    # åº”ç”¨æ§åˆ¶
    local_planner.apply_control(throttle, brake, steer)
    world.tick()
```

#### æ–¹å¼2: ä½¿ç”¨åŸå§‹ local_planner.py

```python
from agents.navigation.local_planner import LocalPlanner

# åªéœ€è¦2æ­¥
# æ­¥éª¤1: åˆå§‹åŒ–è§„åˆ’å™¨ï¼ˆåŒ…å«PIDå‚æ•°ï¼‰
opt_dict = {
    'target_speed': 30.0,
    'lateral_control_dict': {'K_P': 1.95, 'K_I': 0.05, 'K_D': 0.2, 'dt': 0.05},
    'longitudinal_control_dict': {'K_P': 1.0, 'K_I': 0.05, 'K_D': 0, 'dt': 0.05},
}
local_planner = LocalPlanner(vehicle, opt_dict=opt_dict)
local_planner.set_global_plan(route)

# æ­¥éª¤2: å¯¼èˆªå¾ªç¯ï¼ˆæ›´ç®€å•ï¼‰
while not local_planner.done():
    # ç›´æ¥è·å–æ§åˆ¶æŒ‡ä»¤
    control = local_planner.run_step()  # è¿”å› VehicleControl
    
    # ç›´æ¥åº”ç”¨ï¼ˆä¸éœ€è¦å¤–éƒ¨æ§åˆ¶å™¨ï¼‰
    vehicle.apply_control(control)
    world.tick()
```

#### æ–¹å¼3: ä½¿ç”¨ planner.py

```python
from planner.planner import Planner

# åªæä¾›é«˜å±‚å‘½ä»¤
planner = Planner('Town01')

while True:
    # è·å–é«˜å±‚å‘½ä»¤
    command = planner.get_next_command(
        source=[x1, y1],
        source_ori=[ox1, oy1],
        target=[x2, y2],
        target_ori=[ox2, oy2]
    )  # è¿”å›æµ®ç‚¹æ•°
    
    if command == 0.0:  # REACH_GOAL
        print("åˆ°è¾¾ç›®æ ‡")
        break
    elif command == 3.0:  # TURN_LEFT
        # ä½ éœ€è¦è‡ªå·±å®ç°å·¦è½¬é€»è¾‘
        execute_left_turn()
    elif command == 4.0:  # TURN_RIGHT
        # ä½ éœ€è¦è‡ªå·±å®ç°å³è½¬é€»è¾‘
        execute_right_turn()
    elif command == 5.0:  # GO_STRAIGHT
        # ä½ éœ€è¦è‡ªå·±å®ç°ç›´è¡Œé€»è¾‘
        execute_straight()
    elif command == 2.0:  # LANE_FOLLOW
        # ä½ éœ€è¦è‡ªå·±å®ç°è½¦é“è·Ÿéšé€»è¾‘
        execute_lane_follow()
```

---

## ğŸ” æ ¸å¿ƒå·®å¼‚è¯¦è§£

### å·®å¼‚1: è¿”å›å€¼ç±»å‹

```python
# local_planner_info.py
target_info = local_planner.run_step()
print(type(target_info))  # <class 'dict'>
print(target_info.keys())  # dict_keys(['target_waypoint', 'target_road_option', ...])

# åŸå§‹ local_planner.py
control = local_planner.run_step()
print(type(control))  # <class 'carla.VehicleControl'>
print(control.throttle)  # 0.45
print(control.brake)     # 0.0
print(control.steer)     # -0.12

# planner.py
command = planner.get_next_command(...)
print(type(command))  # <class 'float'>
print(command)  # 3.0 (TURN_LEFT)
```

### å·®å¼‚2: æ˜¯å¦åŒ…å«æ§åˆ¶æŒ‡ä»¤

```python
# local_planner_info.py - ä¸åŒ…å« âŒ
target_info = local_planner.run_step()
# æ²¡æœ‰ throttle, brake, steer
# éœ€è¦è‡ªå·±è®¡ç®—

# åŸå§‹ local_planner.py - åŒ…å« âœ…
control = local_planner.run_step()
# æœ‰ throttle, brake, steer
# å·²ç»è®¡ç®—å¥½äº†

# planner.py - ä¸åŒ…å« âŒ
command = planner.get_next_command(...)
# åªæœ‰æ–¹å‘å‘½ä»¤ï¼ˆLEFT/RIGHT/STRAIGHTï¼‰
# éœ€è¦è‡ªå·±å®ç°å…·ä½“æ§åˆ¶
```

### å·®å¼‚3: æ§åˆ¶å™¨ä½ç½®

```python
# local_planner_info.py
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LocalPlanner        â”‚
â”‚ - ç®¡ç†è·¯ç‚¹é˜Ÿåˆ—      â”‚
â”‚ - è¿”å›ç›®æ ‡ä¿¡æ¯      â”‚  â† åªè´Ÿè´£è·¯ç‚¹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤–éƒ¨æ§åˆ¶å™¨          â”‚  â† ä½ è‡ªå·±å®ç°
â”‚ - è®¡ç®—æ§åˆ¶æŒ‡ä»¤      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# åŸå§‹ local_planner.py
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LocalPlanner        â”‚
â”‚ - ç®¡ç†è·¯ç‚¹é˜Ÿåˆ—      â”‚  â† è·¯ç‚¹ + æ§åˆ¶å™¨
â”‚ - å†…ç½®PIDæ§åˆ¶å™¨     â”‚     éƒ½åœ¨å†…éƒ¨
â”‚ - è¿”å›æ§åˆ¶æŒ‡ä»¤      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# planner.py
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Planner             â”‚
â”‚ - è®¡ç®—è·¯çº¿          â”‚  â† åªè´Ÿè´£é«˜å±‚å†³ç­–
â”‚ - è¿”å›æ–¹å‘å‘½ä»¤      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
  ä½ éœ€è¦å®ç°æ‰€æœ‰ç»†èŠ‚
  (è·¯ç‚¹ç®¡ç† + æ§åˆ¶å™¨)
```

---

## ğŸ“ˆ æ•°æ®æµå¯¹æ¯”

### local_planner_info.py (ä½ çš„ç‰ˆæœ¬)

```
è¾“å…¥: æ— ï¼ˆä½¿ç”¨å†…éƒ¨é˜Ÿåˆ—ï¼‰
  â†“
run_step()
  â†“
å¤„ç†:
  1. ç®¡ç†è·¯ç‚¹é˜Ÿåˆ—
  2. æ¸…ç†å·²é€šè¿‡è·¯ç‚¹
  3. è·å–ç›®æ ‡è·¯ç‚¹
  â†“
è¾“å‡º: target_info å­—å…¸
  â†“
å¤–éƒ¨æ§åˆ¶å™¨
  â†“
è¾“å‡º: throttle, brake, steer
  â†“
apply_control()
  â†“
è½¦è¾†æ‰§è¡Œ
```

### åŸå§‹ local_planner.py

```
è¾“å…¥: æ— ï¼ˆä½¿ç”¨å†…éƒ¨é˜Ÿåˆ—ï¼‰
  â†“
run_step()
  â†“
å¤„ç†:
  1. ç®¡ç†è·¯ç‚¹é˜Ÿåˆ—
  2. æ¸…ç†å·²é€šè¿‡è·¯ç‚¹
  3. è·å–ç›®æ ‡è·¯ç‚¹
  4. å†…ç½®PIDæ§åˆ¶å™¨è®¡ç®—  â† å¤šäº†è¿™ä¸€æ­¥
  â†“
è¾“å‡º: VehicleControl å¯¹è±¡
  â†“
è½¦è¾†æ‰§è¡Œ
```

### planner.py

```
è¾“å…¥: source, target (ä½ç½®å’Œæœå‘)
  â†“
get_next_command()
  â†“
å¤„ç†:
  1. è®¡ç®—è·¯çº¿
  2. åˆ¤æ–­è½¬å‘
  â†“
è¾“å‡º: å‘½ä»¤æ•°å€¼ (0.0-5.0)
  â†“
éœ€è¦è‡ªå·±å®ç°æ‰€æœ‰ç»†èŠ‚
```

---

## ğŸ“ é€‰æ‹©å»ºè®®

### é€‰æ‹© local_planner_info.py å½“ä½ ï¼š
- âœ… æƒ³è¦å®Œå…¨æ§åˆ¶è½¦è¾†è¡Œä¸º
- âœ… éœ€è¦æµ‹è¯•æ–°çš„æ§åˆ¶ç®—æ³•
- âœ… ä½¿ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹
- âœ… éœ€è¦çµæ´»æ€§

### é€‰æ‹©åŸå§‹ local_planner.py å½“ä½ ï¼š
- âœ… åªæƒ³å¿«é€Ÿå®ç°å¯¼èˆª
- âœ… PIDæ§åˆ¶å™¨å¤Ÿç”¨
- âœ… ä¸éœ€è¦è‡ªå®šä¹‰æ§åˆ¶
- âœ… ä½¿ç”¨BasicAgent/BehaviorAgent

### é€‰æ‹© planner.py å½“ä½ ï¼š
- âœ… åªéœ€è¦é«˜å±‚å†³ç­–
- âœ… ä½¿ç”¨ç®€åŒ–çš„2Dåœ°å›¾
- âœ… è‡ªå·±å®ç°æ‰€æœ‰åº•å±‚ç»†èŠ‚
- âœ… ç‰¹æ®Šçš„åœ°å›¾æ ¼å¼

---

## ğŸ’¡ å®é™…å¯¹æ¯”ç¤ºä¾‹

### åŒæ ·çš„ä»»åŠ¡ï¼šä»Aç‚¹å¯¼èˆªåˆ°Bç‚¹

```python
# ==================== æ–¹å¼1: local_planner_info.py ====================
# çµæ´»ä½†éœ€è¦æ›´å¤šä»£ç 

local_planner = LocalPlanner(vehicle)
local_planner.set_global_plan(route)
controller = MyController()

while not local_planner.done():
    target_info = local_planner.run_step()           # è·å–ç›®æ ‡ä¿¡æ¯
    t, b, s = controller.compute(target_info, vehicle)  # è‡ªå·±è®¡ç®—æ§åˆ¶
    local_planner.apply_control(t, b, s)             # åº”ç”¨æ§åˆ¶
    world.tick()

# ==================== æ–¹å¼2: åŸå§‹ local_planner.py ====================
# ç®€å•ä½†ä¸çµæ´»

local_planner = LocalPlanner(vehicle, opt_dict={...})  # éœ€è¦PIDå‚æ•°
local_planner.set_global_plan(route)

while not local_planner.done():
    control = local_planner.run_step()  # ç›´æ¥è·å–æ§åˆ¶æŒ‡ä»¤
    vehicle.apply_control(control)       # åº”ç”¨
    world.tick()

# ==================== æ–¹å¼3: planner.py ====================
# æœ€ç®€å•ä½†éœ€è¦è‡ªå·±å®ç°å¾ˆå¤š

planner = Planner('Town01')

while True:
    cmd = planner.get_next_command(src, src_ori, tgt, tgt_ori)  # è·å–å‘½ä»¤
    
    if cmd == TURN_LEFT:
        # éœ€è¦è‡ªå·±å®ç°å·¦è½¬çš„æ‰€æœ‰é€»è¾‘
        # - è·¯ç‚¹ç®¡ç†
        # - é€Ÿåº¦æ§åˆ¶
        # - è½¬å‘æ§åˆ¶
        pass
```

---

## ğŸ“Š æ€»ç»“è¡¨æ ¼

| ç‰¹æ€§ | local_planner_info.py | åŸå§‹ local_planner.py | planner.py |
|------|----------------------|----------------------|------------|
| **å¤æ‚åº¦** | ä¸­ç­‰ | ä½ | é«˜ |
| **çµæ´»æ€§** | é«˜ | ä½ | æœ€é«˜ |
| **ä»£ç é‡** | å¤š | å°‘ | æœ€å¤š |
| **å­¦ä¹ æ›²çº¿** | ä¸­ç­‰ | ç®€å• | é™¡å³­ |
| **é€‚åˆæ–°æ‰‹** | ğŸŸ¡ ä¸­ç­‰ | âœ… é€‚åˆ | âŒ ä¸é€‚åˆ |
| **é€‚åˆç ”ç©¶** | âœ… é€‚åˆ | ğŸŸ¡ ä¸€èˆ¬ | âœ… é€‚åˆ |

---

**æ€»ç»“ï¼šä½ çš„ local_planner_info.py è¿”å›"ç›®æ ‡ä¿¡æ¯"ï¼ŒåŸå§‹ç‰ˆæœ¬è¿”å›"æ§åˆ¶æŒ‡ä»¤"ï¼Œplanner.py è¿”å›"æ–¹å‘å‘½ä»¤"ï¼** ğŸ¯

